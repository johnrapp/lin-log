---
title: "Predicting the burned area of a forest fire in northeastern Portugal"
author: "Axel SjÃ¶berg & John Rapp Farnes"
date: "14 maj 2019"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 3
  pdf_document:
    fig_caption: yes
    number_sections: yes
    toc: yes
    toc_depth: 3
classoption: a4paper
---

```{r setup_knitr, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  collapse = TRUE,
  comment = "#>"
)

options(tinytex.verbose = TRUE)
```

```{r setup_pdf, eval = FALSE}
# Install from CRAN
install.packages('rmarkdown')
# Render PDF
install.packages("tinytex")
tinytex::install_tinytex()  # install TinyTeX
```

```{r, code = readLines("lib.R")}

```

```{r, code = readLines("script.R")}


```


```{r}
titanic <- read.csv("titanic.csv")
titanic <- subset(titanic, select = -c(Name))
colnames(titanic) <- c(
  "survived",
  "pclass",
  "sex",
  "age",
  "siblings.spouses",
  "parents.children",
  "fare"
)

titanic
```



<!-- Abstract? -->

# Introduction

<!-- The aim of this paper is to use meteorological and other data collected in the northeast of Portugal to predict the burned area of a forest fire. The dependent variable in this paper will be the burned area of the forest (in ha) and the independent variables considered are listed below -->

# Analysis

```{r}
ggpairs(titanic)
```

```{r}
hist(titanic$fare)

high.fare.passengers <- which(titanic$fare > 200)

low.fare.passengers <- which(titanic$fare <= 0)

titanic[high.fare.passengers,]
titanic[low.fare.passengers,]

length(high.fare.passengers)
length(low.fare.passengers)
```

```{r}
hist(titanic$parents.children)
which(titanic$parents.children > 2)
```


```{r}
# titanic <- titanic[-high.fare.passengers,]
#   
# hist(log(titanic$Fare))

titanic <- cbind(titanic, log.fare = log(titanic$fare + 1))
hist(titanic$log.fare)
```



```{r}
model.log.fare <- plot.binary.model(survived ~ log.fare, titanic, titanic$survived, titanic$log.fare, "log.fare", c(0, 500), 1)
plot.binary.model(survived ~ siblings.spouses, titanic, titanic$survived, titanic$siblings.spouses, "siblings.spouses", c(0, 10), 40)
plot.binary.model(survived ~ parents.children, titanic, titanic$survived, titanic$parents.children, "parents.children", c(0, 10), 40)

summary(model.log.fare)
dataset <- titanic
pR2(model.log.fare)["r2CU"]
```

```{r}
# The log(fare) model

model.log.fare <- plot.binary.model(survived ~ log.fare, titanic, titanic$survived, titanic$log.fare, "log.fare", c(0, 500), 1)

model.log.fare <- glm(survived ~ log.fare, data = titanic, family = "binomial")

sum <- summary(model.log.fare)

```
Seems reasomable, kernel smoother looks good. The fitted model and kernel smoother cover a large part of the Y-axis. Should consider removing extreme data far to the left if they have a large influence, Cook's distance and influence will tell the. 

```{r}
coeff.beta <- model.log.fare$coefficients

ci.beta <- suppressMessages(confint(model.log.fare))

beta.p <- sum$coefficients[, "Pr(>|z|)"]



table.beta.ci <- cbind("Estimate" = coeff.beta, ci.beta, "P-value" = beta.p)
row.names(table.beta.ci) <- c("$\\beta_0$", "$\\beta_{log(fare)}$")

table.caption <- "\\label{tab:log(fare)_beta}$\\beta$-values of \\texttt{log(fare)} model, with 95 \\% confidence inteval"
kable(table.beta.ci, caption = table.caption, digits = c(rep(2,3), 5))



```
Both of the Beta estimates have a P-value which is very small, meaning that the estimates are significant to a very high extent. 


```{r}
standard.error = 1.96
x0 <- data.frame(log.fare = c(log(15), log(100)))

exp.x0 <- exp(x0)



predx <- cbind(x0, prob = predict(model.log.fare, x0, type = "response"))

xb <- predict(model.log.fare, x0, se.fit = TRUE)
ci.xb <- data.frame(lwr = xb$fit - standard.error * xb$se.fit,
                    upr = xb$fit + standard.error * xb$se.fit)
# transform to CI for the odds:
ci.odds <- exp(ci.xb)

# and finally CI for the probabilities and add to the plot:
predx <- cbind(predx$log.fare, predx$prob * 100, to.prob(ci.odds) * 100)
predx[,1] <-exp.x0

table.caption <- "\\label{tab:log.fare_predictions} Predictions of `log.fare` model"
kable(predx, caption = table.caption, col.names = c("Fare Price", "Probability (%)", "2.5 %", "97.5 %"), digits = 1)

```

#Adding a varible, that say that the predcted chance of survival is true or 1 if the probability of survival is over 50 % and vice verca for the chance of not surviving if the survival probability is less than 50 %. 

```{r}




```





Model Performance Analysis



<!-- ```{r} -->
<!-- hist(dataset$area) -->
<!-- hist(dataset$rain) -->

<!-- hist(log(dataset$area)) -->
<!-- hist(log(dataset$area + 1)) -->
<!-- hist(log(dataset$rain)) -->
<!-- hist(log(dataset$rain + 1)) -->

<!-- hist(dataset$temp) -->
<!-- hist(dataset$RH) -->
<!-- hist(dataset$wind) -->

<!-- plot(dataset$X, dataset$Y) -->

<!-- #temp, RH, wind and rain -->
<!-- pairs(~ area + temp + RH + wind + rain, data = dataset) -->

<!-- pairs(~ log(area + 1) + temp + RH + wind + log(rain + 1), data = dataset) -->

<!-- ``` -->

<!-- ```{r} -->
<!-- hist(dataset$FFMC) -->
<!-- hist((dataset$FFMC)^(1/3)) -->


<!-- # FFMC, DMC, DC, ISI -->
<!-- pairs(~ area + FFMC + DMC + DC + ISI, data = dataset) -->
<!-- pairs(~ log(area + 1) + FFMC + DMC + DC + ISI, data = dataset) -->

<!-- pairs(~ FFMC + DMC + DC + ISI + temp + RH + wind + log(rain + 1), data = dataset) -->

<!-- # pairs(~ log(area + 1) + FFMC.squared + DMC + DC + ISI, data = dataset) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dataset <- cbind(dataset, log.area = log(dataset$area + 1), log.rain = log(dataset$rain + 1)) -->

<!-- ``` -->

<!-- ```{r} -->
<!-- dataset.cut <- dataset[dataset$area > 0,] -->
<!-- dataset.cut -->

<!-- pairs(~ log(area) + temp + RH + wind, data = dataset.cut) -->


<!-- ``` -->



<!-- ```{r} -->
<!-- inverse.log <- function(x) exp(x) - 1 -->

<!-- model.wind <- plot.correlation.model(area ~ wind, "wind", c(0, 10)) -->
<!-- model.temp <- plot.correlation.model(area ~ temp, "temp", c(0, 35)) -->
<!-- model.RH <- plot.correlation.model(area ~ RH, "RH", c(15, 110)) -->

<!-- summary(model.wind) -->
<!-- summary(model.temp) -->
<!-- summary(model.RH) -->

<!-- calc.metrics.models(list(model.wind, model.temp, model.RH), c("wind", "temp", "RH")) -->

<!-- ``` -->
<!-- ```{r} -->
<!-- dataset -->
<!-- hist(dataset$area) -->
<!-- summary(dataset$area) -->
<!-- ``` -->

<!-- ```{r} -->

<!-- dataset <- cbind(dataset, big.fire = ifelse(dataset$area > 0, 1, 0)) -->

<!-- pairs(~ big.fire + temp + RH + wind, data = dataset) -->

<!-- ``` -->

<!-- ```{r} -->

<!-- model.wind <- plot.binary.model(big.fire ~ wind, dataset$big.fire, dataset$wind, "wind", c(0, 10), 10) -->
<!-- model.temp <- plot.binary.model(big.fire ~ temp, dataset$big.fire, dataset$temp, "temp", c(0, 35), 10) -->
<!-- model.RH <- plot.binary.model(big.fire ~ RH, dataset$big.fire, dataset$RH, "RH", c(15, 110), 10) -->

<!-- summary(model.temp) -->
<!-- ``` -->


